## 프로젝트 생싱 및 세팅

> Docker 설치 필요!

### Spring 프로젝트 생성
- lombok
- Spring Batch
- Spring web
- MySQL Driver
- JDBC API

위 Dependency 추가

### Docker MySQL 실행
```shell
docker run --name mysql-container -e MYSQL_ROOT_PASSWORD=1234 -p 3306:3306 -d mysql
```

### DB 생성 및 설정 정보 입력
배치 작업 관리용 DB와 실제 데이터가 존재하는 데이터 DB 두개를 만들어야 한다.  

DB 서버를 각각 구해도 되고 하나 MySQL 서버 안에서 2개의 DB를 만들어도 된다.  
여기서는 후자의 방식으로 진행

db 접속 후 두개의 DB 생성
```shell
CREATE DATABASE meta_db;
CREATE DATABASE data_db;
```
각각의 DB에 연결하기 위해서 spring의 application.yml에 각 연결 정보를 입력
```text
spring:
  datasource-meta:
    driver-class-name: com.mysql.cj.jdbc.driver
    jdbc-url: jdbc:mysql://localhost:3306/meta_db
    username: root
    password: 1234
  datasource-data:
    driver-class-name: com.mysql.cj.jdbc.driver
    jdbc-url: jdbc:mysql://localhost:3306/data_db
    username: root
    password: 1234
```

참고로 단일이 아닌 2개 이상의 DB 연결 시에는 충돌 방지를 위해 각 정보를 바탕으로 config 설정이 필수이다.  
다시 말해 각 DB 연결을 위해 2개의 DataSource를 필요로 하는데 이때 Spring Bean으로 등록될 때 똑같은 타입의 객체가 2개이므로 구분할 필요가 있다.  

이때 기본적인 메타데이터는 @Primary로 잡혀 있는 DB 소스에 초기화
```java
@Configuration
public class MetaDBConfig {
    @Bean
    @Primary
    @ConfigurationProperties(prefix = "spring.datasource-meta")
    public DataSource metaDBSource() {
        return DataSourceBuilder.create().build();
    }

    @Primary
    @Bean
    public PlatformTransactionManager metaTransactionManager() {
        return new DataSourceTransactionManager(metaDBSource());
    }
}
```
아래 설정으로 배치 스키마가 어플리케이션 시작시 항상 생성되도록 해줌 원래는 never임
```
spring:
    jdbc:
      initialize-schema: always
```


